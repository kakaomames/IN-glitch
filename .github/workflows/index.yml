name: Deploy Static Site to Pages

on:
  push:
    branches: ["main"] # mainãƒ–ãƒ©ãƒ³ãƒã«Pushã•ã‚ŒãŸã‚‰ç™ºå‹•ï¼

# 1. Pagesãƒ‡ãƒ—ãƒ­ã‚¤ã«å¿…è¦ãªæ¨©é™ã‚’å®šç¾©
permissions:
  contents: read
  pages: write
  id-token: write

# åŒæ™‚å®Ÿè¡Œã®åˆ¶å¾¡ï¼ˆå¤ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦æœ€æ–°ã‚’å„ªå…ˆã™ã‚‹ï¼‰
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build-and-deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¦ ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        # checkout_status = "completed"
        # print(f"checkout_status: {checkout_status}")

      - name: ğŸŸ¢ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '20'
        # node_ver = "20"
        # print(f"node_ver: {node_ver}")

      - name: ğŸ“¥ ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm install
        # install_log = "npm install executed"
        # print(f"install_log: {install_log}")

      - name: ğŸ”¨ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ“ãƒ«ãƒ‰
        run: |
          # ã“ã“ã«ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚’æ›¸ãï¼ˆä¾‹: npm run buildï¼‰
          # ã‚‚ã— index.js ã‚’å‹•ã‹ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ãªã‚‰ `node index.js`
          node index.js
          echo "build_complete: static files generated!"
        # build_status = "success"
        # print(f"build_status: {build_status}")

      - name: âš™ï¸ Pagesã®è¨­å®š
        uses: actions/configure-pages@v4

      - name: ğŸ“¤ æˆæœç‰©ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-pages-artifact@v3
        with:
          # å…¬é–‹ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
          # index.html ãŒãƒ«ãƒ¼ãƒˆã«ã‚ã‚‹ãªã‚‰ '.'
          path: '.' 
        # upload_target = "."
        # print(f"upload_target: {upload_target}")

      - name: ğŸš€ GitHub Pagesã¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼
        id: deployment
        uses: actions/deploy-pages@v4
        # final_url = "Deployment process started"
        # print(f"final_url: {final_url}")
